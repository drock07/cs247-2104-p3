var p3App=angular.module("p3App",["ui.router","firebase"]);p3App.config(["$stateProvider","$locationProvider","$urlRouterProvider",function(e,o,t){o.html5Mode(!0),t.otherwise("/"),e.state("home",{url:"/",templateUrl:"/partials/home.html",controller:"HomeCtrl"}).state("chatroom",{url:"/chatroom/:chatroomId",templateUrl:"/partials/chatroom.html",controller:"ChatroomCtrl"})}]),p3App.run(["$rootScope","Chatrooms",function(e){e.$on("$stateChangeStart",function(e,o,t,r){"chatRoom"==r.name})}]),p3App.factory("Chatrooms",["$firebase",function(e){var o=e(new Firebase("https://glaring-fire-5264.firebaseio.com/")),t=o.$child("chatrooms"),r={list:function(){return t},get:function(e){return t.$child(e)},send:function(e,o,r){t.$child(e+"/stream").$add({m:o,username:r})},signin:function(e,o){var r=t.$child(e+"/users");r[o]=!0,r.$save()},signout:function(e,o){t.$child(e+"/users").$remove(o)}};return r}]),p3App.directive("ngEnter",function(){return function(e,o,t){o.bind("keydown keypress",function(o){13===o.which&&(e.$apply(function(){e.$eval(t.ngEnter)}),o.preventDefault())})}}),p3App.directive("chatVideo",function(){return{restrict:"AE",link:function(e,o){var t={video:!0,audio:!1},r=function(e){var t=160,r=120,n=o,a=document.createElement("video");n.innerHTML="",a=mergeProps(a,{controls:!1,width:t,height:r,src:URL.createObjectURL(e)}),a.play(),n.append(a),console.log("connect to media stream!")},n=function(e){console.error("media error",e)};navigator.getUserMedia(t,r,n)}}}),p3App.controller("AppCtrl",["$scope",function(e){e.userModel={}}]),p3App.controller("HomeCtrl",["$scope","Chatrooms",function(e,o){e.chatrooms=o.list()}]),p3App.controller("ChatroomCtrl",["$scope","$stateParams","Chatrooms","$window",function(e,o,t){for(e.chatroomId=o.chatroomId,e.chatroom=t.get(o.chatroomId);!e.userModel.username;)e.userModel.username="david";t.signin(e.chatroomId,e.userModel.username),e.sendChatMessage=function(){e.chatMessage&&""!=e.chatMessage&&(t.send(e.chatroomId,e.chatMessage,e.userModel.username),e.chatMessage="")}}]);